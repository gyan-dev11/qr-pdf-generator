<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>QR to PDF Generator</title>
    <style>
        body {
            font-family: sans-serif;
            max-width: 600px;
            margin: 40px auto;
        }

        input[type="text"] {
            width: 100%;
            padding: 10px;
            margin: 10px 0;
        }

        button {
            padding: 10px 20px;
        }

        .message {
            padding: 10px;
            margin-top: 20px;
            border-radius: 5px;
        }

        .success {
            background-color: #d4edda;
            color: #155724;
        }

        .error {
            background-color: #f8d7da;
            color: #721c24;
        }
    </style>
</head>

<body>
    <h2>QR to PDF Generator</h2>

    <label>QR Folder:</label>
    <input type="text" id="qr_folder_path" readonly />
    <button onclick="pickFolder('qr_folder_path')">Select QR Folder</button>

    <label>Output Folder:</label>
    <input type="text" id="output_folder_path" readonly />
    <button onclick="pickFolder('output_folder_path')">Select Output Folder</button>

    <label>Logo Image:</label>
    <input type="text" id="logo_path" readonly />
    <button onclick="pickFile('logo_path')">Select Logo</button>

    <button id="generateBtn">Generate PDFs</button>

    <div id="result" class="message" style="display: none;"></div>

    <script>
        async function pickFolder(inputId) {
            console.log(`[UI] Selecting folder for ${inputId}`);
            const folder = await window.electron.selectFolder();
            if (folder) {
                console.log(`[UI] Folder selected: ${folder}`);
                document.getElementById(inputId).value = folder;
            } else {
                console.warn(`[UI] No folder selected for ${inputId}`);
            }
        }

        async function pickFile(inputId) {
            console.log(`[UI] Selecting file for ${inputId}`);
            const file = await window.electron.selectFile();
            if (file) {
                console.log(`[UI] File selected: ${file}`);
                document.getElementById(inputId).value = file;
            } else {
                console.warn(`[UI] No file selected for ${inputId}`);
            }
        }

        document.getElementById('generateBtn').addEventListener('click', async () => {
            const qrPath = document.getElementById('qr_folder_path').value;
            const outputPath = document.getElementById('output_folder_path').value;
            const logoPath = document.getElementById('logo_path').value;

            const resultDiv = document.getElementById('result');
            resultDiv.style.display = 'block';
            resultDiv.className = 'message';
            resultDiv.innerText = 'Processing...';

            console.log('[UI] Generating PDFs with paths:', {
                qrPath,
                outputPath,
                logoPath
            });

            // Basic input validation
            if (!qrPath || !outputPath) {
                resultDiv.className = 'message error';
                resultDiv.innerText = 'QR folder and Output folder are required.';
                console.error('[UI] Missing required folders.');
                return;
            }

            const data = {
                qr_folder: qrPath,
                output_folder: outputPath,
                logo_path: logoPath
            };

            try {
                const res = await fetch('http://localhost:5000/generate', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });

                const msg = await res.text();
                resultDiv.className = res.ok ? 'message success' : 'message error';
                resultDiv.innerText = msg;
                console.log('[UI] Response:', msg);
            } catch (err) {
                console.error('[UI] Fetch error:', err);
                resultDiv.className = 'message error';
                resultDiv.innerText = 'Failed to reach Flask server.';
            }
        });
    </script>

</body>

</html>